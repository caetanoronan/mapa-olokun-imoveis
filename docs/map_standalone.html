<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mapa Olokun — Versão Estática</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <!-- MarkerCluster CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <style>
    html,body,#map{height:100%;margin:0;padding:0}
    body{font-family:system-ui,Segoe UI,Roboto,Arial}
    .legend{position:absolute;right:10px;top:10px;background:#fff;padding:10px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.12);z-index:500}
    .cm{width:28px;height:28px;border-radius:50%;display:inline-block;border:2px solid rgba(0,0,0,0.12);}
    .cm--casa{background:#2ca25f}
    .cm--apartamento{background:#1f7a4a}
    .cm--sala{background:#196f3d}
    .cm--terreno{background:#66bb6a}
    .cm--galpao{background:#2e8b57}
    .popup-body{display:grid;grid-template-columns:120px 1fr;gap:8px;max-width:360px}
    .popup-body img{width:120px;height:80px;object-fit:cover;border-radius:6px}
    .debug{position:absolute;left:12px;top:10px;background:rgba(255,255,255,0.9);padding:6px;border-radius:6px;z-index:600;border:1px solid rgba(0,0,0,0.06)}
  </style>
</head>
<body>
<div id="map"></div>
<div class="legend"><strong>Legenda</strong><br/><span class="cm cm--casa"></span> Casa • <span class="cm cm--apartamento"></span> Apto • <span class="cm cm--sala"></span> Sala • <span class="cm cm--terreno"></span> Terreno • <span class="cm cm--galpao"></span> Galpão</div>
<div class="debug" id="debug">Marcadores: 0 • Tiles: Carregando</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<!-- MarkerCluster JS -->
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
// Dados embutidos (copiados de src/data/properties.js) — se atualizou os dados, re-copia aqui
const properties = [
  {"id":"1","type":"Casa residencial","title":"Casa ampla no bairro Trindade","address":"Rua Exemplo 123, Trindade, Florianópolis - SC","lat":-27.5969,"lng":-48.5223,"areaBuilt":180,"areaLot":300,"bedrooms":4,"bathrooms":3,"parking":2,"price":1250000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Casa","tour":"https://example.com/tour/casa-trindade","contact":"https://example.com/contato"},
  {"id":"2","type":"Apartamento","title":"Apartamento com vista para o mar","address":"Av. Beira-Mar Norte 1500, Centro, Florianópolis - SC","lat":-27.5862,"lng":-48.5501,"areaBuilt":95,"areaLot":null,"bedrooms":3,"bathrooms":2,"parking":1,"price":890000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Apartamento","tour":"https://example.com/tour/apartamento-centro","contact":"https://example.com/contato"},
  {"id":"3","type":"Sala comercial","title":"Sala comercial próxima ao shopping","address":"Rua Comercial 45, Itacorubi, Florianópolis - SC","lat":-27.5903,"lng":-48.5092,"areaBuilt":55,"areaLot":null,"bedrooms":null,"bathrooms":1,"parking":1,"price":3500,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Sala+Comercial","tour":"https://example.com/tour/sala-itacorubi","contact":"https://example.com/contato"},
  {"id":"4","type":"Terreno","title":"Terreno plano em área residencial","address":"Servidão dos Lagos 200, Campeche, Florianópolis - SC","lat":-27.6731,"lng":-48.4909,"areaBuilt":null,"areaLot":450,"bedrooms":null,"bathrooms":null,"parking":null,"price":560000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Terreno","tour":null,"contact":"https://example.com/contato"},
  {"id":"5","type":"Galpão industrial","title":"Galpão industrial com doca","address":"Rodovia SC-401 km 5, João Paulo, Florianópolis - SC","lat":-27.5425,"lng":-48.5007,"areaBuilt":1200,"areaLot":2000,"bedrooms":null,"bathrooms":4,"parking":6,"price":22000,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Galpao","tour":"https://example.com/tour/galpao","contact":"https://example.com/contato"},
  {"id":"6","type":"Casa residencial","title":"Casa aconchegante em Córrego Grande","address":"Rua das Palmeiras 88, Córrego Grande, Florianópolis - SC","lat":-27.5909,"lng":-48.5155,"areaBuilt":140,"areaLot":280,"bedrooms":3,"bathrooms":2,"parking":2,"price":980000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Casa+2","tour":null,"contact":"https://example.com/contato"},
  {"id":"7","type":"Casa residencial","title":"Casa com jardim na Lagoa da Conceição","address":"Rua das Araras 12, Lagoa da Conceição, Florianópolis - SC","lat":-27.5998,"lng":-48.4523,"areaBuilt":210,"areaLot":520,"bedrooms":4,"bathrooms":3,"parking":3,"price":1750000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Casa+3","tour":"https://example.com/tour/casa-lagoa","contact":"https://example.com/contato"},
  {"id":"8","type":"Casa residencial","title":"Casa mobiliada em Coqueiros (aluguel)","address":"Rua Alameda 30, Coqueiros, Florianópolis - SC","lat":-27.6041,"lng":-48.5831,"areaBuilt":130,"areaLot":250,"bedrooms":3,"bathrooms":2,"parking":1,"price":4800,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Casa+4","tour":null,"contact":"https://example.com/contato"},
  {"id":"9","type":"Casa residencial","title":"Casa térrea no Campeche","address":"Servidão do Sol 55, Campeche, Florianópolis - SC","lat":-27.6775,"lng":-48.4921,"areaBuilt":160,"areaLot":360,"bedrooms":3,"bathrooms":2,"parking":2,"price":1150000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Casa+5","tour":null,"contact":"https://example.com/contato"},
  {"id":"10","type":"Apartamento","title":"Apartamento no Centro, 2 dorm","address":"Rua Felipe Schmidt 900, Centro, Florianópolis - SC","lat":-27.596,"lng":-48.5489,"areaBuilt":68,"areaLot":null,"bedrooms":2,"bathrooms":1,"parking":1,"price":620000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Ap+2","tour":null,"contact":"https://example.com/contato"},
  {"id":"11","type":"Apartamento","title":"Apartamento moderno na Agronômica","address":"Av. Mauro Ramos 1200, Agronômica, Florianópolis - SC","lat":-27.585,"lng":-48.5402,"areaBuilt":85,"areaLot":null,"bedrooms":2,"bathrooms":2,"parking":2,"price":780000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Ap+3","tour":"https://example.com/tour/ap-agronomica","contact":"https://example.com/contato"},
  {"id":"12","type":"Apartamento","title":"Apartamento mobiliado nos Ingleses (aluguel)","address":"Rua das Gaivotas 300, Ingleses, Florianópolis - SC","lat":-27.4205,"lng":-48.4032,"areaBuilt":72,"areaLot":null,"bedrooms":2,"bathrooms":2,"parking":1,"price":3200,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Ap+4","tour":null,"contact":"https://example.com/contato"},
  {"id":"13","type":"Apartamento","title":"Cobertura Duplex em Jurerê","address":"Alameda das Palmeiras 50, Jurerê Internacional, Florianópolis - SC","lat":-27.4395,"lng":-48.4928,"areaBuilt":160,"areaLot":null,"bedrooms":3,"bathrooms":3,"parking":2,"price":1850000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Ap+5","tour":"https://example.com/tour/cobertura-jurere","contact":"https://example.com/contato"},
  {"id":"14","type":"Sala comercial","title":"Sala comercial no Centro Executivo","address":"Rua Bocaiúva 2500, Centro, Florianópolis - SC","lat":-27.5945,"lng":-48.5482,"areaBuilt":42,"areaLot":null,"bedrooms":null,"bathrooms":1,"parking":1,"price":2900,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Sala+2","tour":null,"contact":"https://example.com/contato"},
  {"id":"15","type":"Sala comercial","title":"Sala comercial ampla na SC-401","address":"Rodovia SC-401 4150, Saco Grande, Florianópolis - SC","lat":-27.5379,"lng":-48.5051,"areaBuilt":75,"areaLot":null,"bedrooms":null,"bathrooms":2,"parking":2,"price":5200,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Sala+3","tour":"https://example.com/tour/sala-sc401","contact":"https://example.com/contato"},
  {"id":"16","type":"Sala comercial","title":"Conjunto comercial em Kobrasol","address":"Av. Central 200, Kobrasol, São José - SC","lat":-27.6004,"lng":-48.611,"areaBuilt":60,"areaLot":null,"bedrooms":null,"bathrooms":1,"parking":1,"price":4100,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Sala+4","tour":null,"contact":"https://example.com/contato"},
  {"id":"17","type":"Sala comercial","title":"Sala comercial mobiliada no Itacorubi","address":"Rua Lauro Linhares 1100, Trindade/Itacorubi, Florianópolis - SC","lat":-27.5942,"lng":-48.5099,"areaBuilt":48,"areaLot":null,"bedrooms":null,"bathrooms":1,"parking":1,"price":3300,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Sala+5","tour":"https://example.com/tour/sala-itacorubi-2","contact":"https://example.com/contato"},
  {"id":"18","type":"Terreno","title":"Terreno em Ratones com vista verde","address":"Rua do Campo 40, Ratones, Florianópolis - SC","lat":-27.488,"lng":-48.492,"areaBuilt":null,"areaLot":600,"bedrooms":null,"bathrooms":null,"parking":null,"price":430000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Terreno+2","tour":null,"contact":"https://example.com/contato"},
  {"id":"19","type":"Terreno","title":"Terreno em Rio Tavares próximo à praia","address":"Servidão das Ondas 22, Rio Tavares, Florianópolis - SC","lat":-27.6798,"lng":-48.4972,"areaBuilt":null,"areaLot":380,"bedrooms":null,"bathrooms":null,"parking":null,"price":520000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Terreno+3","tour":null,"contact":"https://example.com/contato"},
  {"id":"20","type":"Terreno","title":"Terreno em Ingleses, esquina","address":"Rua das Bromélias 77, Ingleses, Florianópolis - SC","lat":-27.4172,"lng":-48.4125,"areaBuilt":null,"areaLot":500,"bedrooms":null,"bathrooms":null,"parking":null,"price":610000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Terreno+4","tour":null,"contact":"https://example.com/contato"},
  {"id":"21","type":"Terreno","title":"Terreno em Santo Antônio de Lisboa","address":"Rua das Alfazemas 10, Santo Antônio de Lisboa, Florianópolis - SC","lat":-27.5009,"lng":-48.5228,"areaBuilt":null,"areaLot":700,"bedrooms":null,"bathrooms":null,"parking":null,"price":890000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Terreno+5","tour":null,"contact":"https://example.com/contato"},
  {"id":"22","type":"Galpão industrial","title":"Galpão na SC-401 com pé-direito alto","address":"Rodovia SC-401 7000, Saco Grande, Florianópolis - SC","lat":-27.5299,"lng":-48.5132,"areaBuilt":900,"areaLot":1500,"bedrooms":null,"bathrooms":3,"parking":5,"price":17500,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Galpao+2","tour":null,"contact":"https://example.com/contato"},
  {"id":"23","type":"Galpão industrial","title":"Galpão com mezanino e escritório","address":"Rua Industrial 120, Barreiros, São José - SC","lat":-27.5902,"lng":-48.6278,"areaBuilt":750,"areaLot":1300,"bedrooms":null,"bathrooms":2,"parking":4,"price":1350000,"priceType":"venda","photo":"https://placehold.co/300x180?text=Galpao+3","tour":"https://example.com/tour/galpao-barreiros","contact":"https://example.com/contato"},
  {"id":"24","type":"Galpão industrial","title":"Galpão logístico com pátio","address":"Rua do Porto 400, Estreito, Florianópolis - SC","lat":-27.6019,"lng":-48.5925,"areaBuilt":1100,"areaLot":2200,"bedrooms":null,"bathrooms":3,"parking":8,"price":25000,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Galpao+4","tour":null,"contact":"https://example.com/contato"},
  {"id":"25","type":"Galpão industrial","title":"Galpão em área industrial","address":"Rua dos Fabricantes 50, Forquilhinhas, São José - SC","lat":-27.6055,"lng":-48.6501,"areaBuilt":1400,"areaLot":3000,"bedrooms":null,"bathrooms":5,"parking":10,"price":28500,"priceType":"aluguel","photo":"https://placehold.co/300x180?text=Galpao+5","tour":"https://example.com/tour/galpao-industrial","contact":"https://example.com/contato"}
];

// Mapa e layers
const map = L.map('map').setView([-27.5954,-48.5480], 12);
const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

tiles.on('load', () => document.getElementById('debug').textContent = `Marcadores: ${properties.length} • Tiles: OK`);
tiles.on('loading', () => document.getElementById('debug').textContent = `Marcadores: ${properties.length} • Tiles: Carregando`);

const markers = L.markerClusterGroup({chunkedLoading:true});

function keyForType(t){
  if(!t) return 'default';
  const s = t.toLowerCase();
  if(s.startsWith('casa')) return 'casa';
  if(s.startsWith('apart')) return 'apartamento';
  if(s.startsWith('sala')) return 'sala';
  if(s.startsWith('terreno')) return 'terreno';
  if(s.startsWith('galp')) return 'galpao';
  return 'default';
}

function iconHtml(key){
  return `<div class="cm cm--${key}"></div>`;
}

properties.forEach(p => {
  const key = keyForType(p.type);
  const myIcon = L.divIcon({className:'', html:iconHtml(key), iconSize:[32,32], iconAnchor:[16,32]});
  const marker = L.marker([p.lat,p.lng], {icon: myIcon});
  const title = `<strong>${p.title}</strong><br><small>${p.type} &middot; ${p.address}</small>`;
  const details = `<ul style="margin:0;padding-left:16px;font-size:13px">${p.areaBuilt?`<li><strong>Área construída:</strong> ${p.areaBuilt} m²</li>`:''}${p.areaLot?`<li><strong>Área terreno:</strong> ${p.areaLot} m²</li>`:''}${p.bedrooms?`<li><strong>Dormitórios:</strong> ${p.bedrooms}</li>`:''}${p.bathrooms?`<li><strong>Banheiros:</strong> ${p.bathrooms}</li>`:''}${p.parking?`<li><strong>Vagas:</strong> ${p.parking}</li>`:''}<li><strong>Valor:</strong> ${p.priceType === 'aluguel' ? 'Aluguel' : 'Venda'} • R$ ${p.price.toLocaleString('pt-BR')}</li></ul>`;
  const popup = `<div class="popup-body"><img src="${p.photo}" alt="${p.title}"/><div>${title}${details}<div style="margin-top:6px">${p.tour?`<a href="${p.tour}" target="_blank">Tour virtual</a>`:''} ${p.contact?`<a href="${p.contact}" target="_blank">Contato</a>`:''}</div></div></div>`;
  marker.bindPopup(popup);
  markers.addLayer(marker);
});

map.addLayer(markers);

// centraliza mapa se há muitos marcadores
if(properties.length){
  const latlngs = properties.map(p=>[p.lat,p.lng]);
  const bounds = L.latLngBounds(latlngs);
  map.fitBounds(bounds.pad(0.15));
}

</script>

</body>
</html>